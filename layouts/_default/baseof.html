<!DOCTYPE html>
<html>
  <head>
    {{- partial "head.html" . -}}
  </head>
  <body x-data="themeData()" x-init="loadConfig(); updateNavBarHeight(); updateNavTabHeight(), initScrollSizes()" @resize.window="updateNavBarHeight, updateNavTabHeight">
    {{- block "main" . }}{{- end }}
    {{- partial "footer.html" . -}}
    <div id="itemLists" class="itemLists align-items-end d-flex flex-row-reverse gap-1"></div>
    <script></script>
    <script>
      function themeData() {
        return {
          navBarHeight: "",
          navTabHeight: "",
          currentTheme: "/css/customB4.css",
          scrollRefs: {},

          initScrollSizes() {
            window.addEventListener("DOMContentLoaded", () => {
              setTimeout(() => {
                this.scrollSizes();
              }, 1000); // Delay of 1 second (1000 milliseconds)
            });
          },

          scrollSizes() {
            // Get all elements with x-ref starting with 'scroll'
            const scrollElements = document.querySelectorAll("[x-ref^=scroll]");

            console.log(scrollElements);

            // Calculate and set the heights as CSS variables
            scrollElements.forEach((element) => {
              const refName = element.getAttribute("x-ref");
              const height = element.offsetHeight;
              document.body.style.setProperty(`--${refName}`, `${height}px`);

              // Store the reference and its height in the scrollRefs object
              this.scrollRefs[refName] = height;
            });
          },

          //updateNavBarHeight() {
          //  const navBarElem = this.$refs.navBar;
          //  if (navBarElem) {
          //    const navBarHeight = getComputedStyle(navBarElem).height;
          //    this.navBarHeight = navBarHeight;
          //    document.body.style.setProperty("--navBar", navBarHeight);
          //  }
          //},

          updateNavBarHeight() {
            setTimeout(() => {
              const navBarElem = this.$refs.navBar;
              if (navBarElem) {
                const navBarHeight = getComputedStyle(navBarElem).height;
                this.navBarHeight = navBarHeight;
                document.body.style.setProperty("--navBar", navBarHeight);
              }
            }, 500);
          },

          updateNavTabHeight() {
            setTimeout(() => {
              const navTabElem = this.$refs.navTab;
              if (navTabElem) {
                const navTabHeight = getComputedStyle(navTabElem).height;
                this.navTabHeight = navTabHeight;
                document.body.style.setProperty("--navTab", navTabHeight);
              }
              //const filterElem = this.$refs.filter;
              //console.log(filterElem);
              //if (filterElem) {
              //  const filterHeight = getComputedStyle(filterElem).height;
              //  const heightWithoutPadding = parseInt(filterHeight, 10) - 15 + "px";
              //  this.filterHeight = filterHeight;
              //  document.body.style.setProperty("--filter", heightWithoutPadding);
              //}
            }, 500);
          },
          changeConfig(visibility) {
            this.showConfig = !this.showConfig;
            localStorage.setItem("configVisibility", this.showConfig);
          },

          changeSettings(visibility) {
            console.log("changeSettings:", this.showSettings);
            this.showSettings = !this.showSettings;
            this.showInfo = false;
            localStorage.setItem("infoVisibility", this.showSettings);
            localStorage.setItem("infoVisibility", this.showInfo);
          },
          changeInfo(visibility) {
            console.log("changeInfo:", this.showInfo);
            this.showInfo = !this.showInfo;
            this.showSettings = false;
            localStorage.setItem("infoVisibility", this.showInfo);
            localStorage.setItem("settingsVisibility", this.showSettings);
          },

          changeTheme(themePath) {
            this.currentTheme = themePath;
            localStorage.setItem("selectedTheme", themePath);
            applyTheme(themePath);
          },

          loadConfig() {
            const savedSettings = localStorage.getItem("settingsVisibility");
            console.log(savedSettings);
            if (savedSettings !== null) {
              this.showSettings = savedSettings === "true";
            } else {
              this.showSettings = false;
            }

            const savedInfo = localStorage.getItem("infoVisibility");
            if (savedInfo !== null) {
              this.showInfo = savedInfo === true;
            } else {
              this.showInfo = false;
            }

            const savedConfig = localStorage.getItem("configVisibility");
            if (savedConfig !== null) {
              this.showConfig = savedConfig === "true";
            } else {
              this.showConfig = true;
            }

            const savedTheme = localStorage.getItem("selectedTheme");
            if (savedTheme) {
              this.currentTheme = savedTheme;
              applyTheme(savedTheme);
            } else {
              this.currentTheme = "/css/customB4.css";
              applyTheme(this.currentTheme);
            }
          },
        };
      }

      function applyTheme(themePath) {
        const linkElement = document.getElementById("themeStylesheet");
        linkElement.href = themePath;
      }
    </script>
  </body>

  {{ $test:= 0 }}

  {{ if $test }}
    <body>
      <div x-data="{navBarHeight: '', navTabHeight: ''}" x-init="updateNavBarHeight" @resize.window="updateNavBarHeight">
        <div x-ref="navBar">
          <span>
            <span> navBarHeight: <span x-text="navBarHeight"></span> </span>
            <span> navTabHeight: <span x-text="navTabHeight"></span> </span>
          </span>
        </div>
        <main x-data="{selectedId: null}" x-init="updateNavTabHeight" @resize.window="updateNavTabHeight">
          <div x-ref="navTab">
            test
            <hr />
          </div>
          <p>something else</p>
        </main>
      </div>

      <script>
        function updateNavBarHeight() {
          const navBarElem = this.$refs.navBar;
          if (navBarElem) {
            const navBarHeight = getComputedStyle(navBarElem).height;
            this.navBarHeight = navBarHeight;
            document.body.style.setProperty("--navBar", navBarHeight);
          }
        }
        function updateNavTabHeight() {
          const navTabElem = this.$refs.navTab;
          if (navTabElem) {
            const navTabHeight = getComputedStyle(navTabElem).height;
            this.navTabHeight = navTabHeight;
            document.body.style.setProperty("--navTab", navTabHeight);
          }
        }
      </script>
    </body>
  {{ end }}
</html>
